<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFC WEBSITE</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="https://www.gstatic.com/firebasejs/9.6.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.2/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,100;0,200;0,400;0,800;1,300&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>

<body>

    <nav class="navbar" style="background-color: rgb(103, 58, 183); height: 25px;">
        <div class="container">
            <!-- Navbar content goes here -->
        </div>
    </nav>
    <div class="form-container mt-4">
        <form>
            <div class="container-fluid mt-2">
                <div class="gform1 mx-auto text-center">
                        <h2>Attendance</h2>
                        <p>
                            Automated Attendance Monitoring and Tracking System using NFC Tags
                        </p>
         
                </div>
            </div>
            <div class="container-fluid mt-2">
                <div class="gform mx-auto">
                    <div class="form-group mb-3">
                        <label for="student_num" class="form-label">BU Student Number</label>
                        <div class="input-div">
                            <input type="text" id="student_num" name="student_num"  placeholder="Your student number" required>
                        </div>
                 
                    </div>
                </div>
            </div>
            <div class="container-fluid mt-2">
                <div class="gform mx-auto">
                    <div class="form-group mb-3">
                        <label for="full_name" class="form-label">Student Name</label><br>
                        <small class="form-text text-muted">Ex. Last Name, First Name, MI. Extension Name (eg. JR, II)</small>          
                        <div class="input-div">
                             <input type="text" id="full_name" name="full_name"  placeholder="Your student name" required>
                            </div>
                    </div>
                </div>
            </div>      
            <!-- <div class="container-fluid mt-2">
                <div class="gform2 mx-auto">
                    <div class="form-group mb-3">
                        <label for="isIrregular" class="form-label">Irregular Student</label>
                        <div>
                            <input type="radio" class="radio" id="yesOption" name="irregularStudent" value="Yes">
                            <label for="yesOption" class="small-text">Yes</label>
                        </div>
                        <div>
                            <input type="radio" class="radio"  id="noOption" name="irregularStudent" value="No">
                            <label for="noOption" class="small-text">No</label>
                        </div>
                    </div>
                </div>
            </div> -->
            <div class="container-fluid mt-2">
                <div class="gform2 mx-auto">
                    <div class="form-group mb-3">
                        <label for="course_option" class="form-label">Course</label>
                        <div>
                            <input type="radio" class="radio" id="bscs" name="course" value="Bachelor of Science in Computer Science" required>
                            <label for="bscs" class="small-text">Bachelor of Science in Computer Science</label>
                        </div>
                        <div>
                            <input type="radio" class="radio" id="bsis" name="course" value="Bachelor of Science in Information System" required>
                            <label for="bsis" class="small-text">Bachelor of Science in Information System</label>
                        </div>
                        <div>
                            <input type="radio" class="radio" id="bsit" name="course" value="Bachelor of Science in Information Technology" required>
                            <label for="bsit" class="small-text">Bachelor of Science in Information Technology</label>
                        </div>
                            <div>
                                <input type="radio" class="radio" id="bsita" name="course" value="Bachelor of Science in Information Technology major in Animation" required>
                                <label for="bsita" class="small-text">Bachelor of Science in Information Technology major in Animation</label>
            
                            </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid mt-2">
                <div class="gform2 mx-auto">
                    <div class="form-group mb-3">
                        <label for="year_option" class="form-label">Year Level</label>
                        <div>
                            <input type="radio" class="radio" id="1" name="year" value="1st Year" required>
                            <label for="1" class="small-text">1st Year</label>
                        </div>
                        <div>
                            <input type="radio" class="radio" id="2" name="year" value="2nd Year" required>
                            <label for="2" class="small-text">2nd Year</label>
                        </div>
                        <div>
                            <input type="radio" class="radio" id="3" name="year" value="3rd Year" required>
                            <label for="3" class="small-text">3rd Year</label>
                        </div>
                        <div>
                            <input type="radio" class="radio" id="4" name="year" value="4th Year" required>
                            <label for="4" class="small-text">4th Year</label>
                        </div>
                    </div>
                </div>
            </div>          
            <div class="container-fluid mt-2">
                <div class="gform2 mx-auto">
                    <div class="form-group mb-3">
                        <label for="block_option" class="form-label">Block</label>
                        <div>
                            <input type="radio" class="radio" id="A" name="block" value="A" required>
                            <label for="A" class="small-text">A</label>
                        </div>
                        <div>
                            <input type="radio" class="radio" id="B" name="block" value="B" required>
                            <label for="B" class="small-text">B</label>
                        </div>
                        <div>
                            <input type="radio" class="radio" id="C" name="block" value="C" required>
                            <label for="C" class="small-text">C</label>
                        </div>
                        <div>
                            <input type="radio" class="radio" id="D" name="block" value="D" required>
                            <label for="D" class="small-text">D</label>
                        </div>
                    </div>
                </div>
            </div>
            

        

            <button class="submit">Submit</button>
        </form>
    </div>

    <!-- Bootstrap JS (Optional) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, addDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";


    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyDfNr3VPTj-yzgBK9BLjNiwEQ11ITiTp4E",
        authDomain: "nfc-app-fb987.firebaseapp.com",
        databaseURL: "https://nfc-app-fb987-default-rtdb.firebaseio.com",
        projectId: "nfc-app-fb987",
        storageBucket: "nfc-app-fb987.appspot.com",
        messagingSenderId: "533389666766",
        appId: "1:533389666766:web:fa6c22da78b5d0a6bbe39f"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);


    // Clear the form


    // Add an event listener to the submit button

    document.querySelector('.submit').addEventListener('click', async (e) => {
        e.preventDefault(); // Prevent the default form submission behavior
    
        // Get form values
        const student_num = document.getElementById('student_num').value;
        const full_name = document.getElementById('full_name').value;
        const course = document.querySelector('input[name="course"]:checked').value;
        const year = document.querySelector('input[name="year"]:checked').value;
        const block = document.querySelector('input[name="block"]:checked').value;

        try {
            // Check if document with student_num and full_name already exists
            const studentQuery = await getDocs(query(collection(db, 'students'), 
                where('student_num', '==', student_num),
                where('full_name', '==', full_name),
                where('course', '==', course),
                where('year_level', '==', year),
                where('block', '==', block)
            ));

            if (studentQuery.size > 0) {
                // Document already exists, show error alert using Swal
                Swal.fire({
                    icon: 'error',
                    title: 'Error!',
                    text: 'Student with the given details already exists',
                    showConfirmButton: false,
                    timer: 2500 // Close after 2 seconds
                });
            } else {
                // Document doesn't exist, add data to Firestore collection
                await addDoc(collection(db, 'students'), {
                    block: block,
                    course: course,
                    full_name: full_name,
                    nfc_written: false,
                    student_num: student_num,
                    year_level: year
                });

                // Show success alert using Swal
                Swal.fire({
                    icon: 'success',
                    title: 'Success!',
                    text: 'Student added successfully.',
                    showConfirmButton: false,
                    timer: 2000 // Close after 2 seconds
                });

                // Clear the form
                document.getElementById('student_num').value = '';
                document.getElementById('full_name').value = '';
                document.querySelector('input[name="course"]:checked').checked = false;
                document.querySelector('input[name="year"]:checked').checked = false;
                document.querySelector('input[name="block"]:checked').checked = false;
            }
        } catch (error) {
            console.error('Error checking/adding document: ', error);

            // Show error alert using Swal
            Swal.fire({
                icon: 'error',
                title: 'Error!',
                text: 'Error checking/adding student.',
                showConfirmButton: false,
                timer: 2000 // Close after 2 seconds
            });
        }
    });
</script>

</html>



</html>

